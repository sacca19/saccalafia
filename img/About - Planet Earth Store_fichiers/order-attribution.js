(function(wc_order_attribution){'use strict';const params=wc_order_attribution.params;const $=document.querySelector.bind(document);const propertyAccessor=(obj,path)=>path.split('.').reduce((acc,part)=>acc&&acc[part],obj);const returnNull=()=>null;const CHECKOUT_STORE_KEY='wc/store/checkout';function getData(){const accessor=params.allowTracking?propertyAccessor:returnNull;const entries=Object.entries(wc_order_attribution.fields).map(([key,property])=>[key,accessor(sbjs.get,property)]);return Object.fromEntries(entries);}
function updateFormValues(values){if($(`input[name^="${params.prefix}"]`)){for(const key of Object.keys(wc_order_attribution.fields)){$(`input[name="${params.prefix}${key}"]`).value=values&&values[key]||'';}}};function updateCheckoutBlockData(values){if(window.wp&&window.wp.data&&window.wp.data.dispatch&&window.wc&&window.wc.wcBlocksData){window.wp.data.dispatch(window.wc.wcBlocksData.CHECKOUT_STORE_KEY).__internalSetExtensionData('woocommerce/order-attribution',values,true);}}
wc_order_attribution.setOrderTracking=function(allow){params.allowTracking=allow;if(!allow){removeTrackingCookies();}else{sbjs.init({lifetime:Number(params.lifetime),session_length:Number(params.session),timezone_offset:'0',});}
const values=getData();updateFormValues(values);updateCheckoutBlockData(values);}
function removeTrackingCookies(){const domain=window.location.hostname;const sbCookies=['sbjs_current','sbjs_current_add','sbjs_first','sbjs_first_add','sbjs_session','sbjs_udata','sbjs_migrations','sbjs_promo'];sbCookies.forEach((name)=>{document.cookie=`${name}=; path=/; max-age=-999; domain=.${domain};`;});}
wc_order_attribution.setOrderTracking(params.allowTracking);if($('form.woocommerce-checkout')!==null){const previousInitCheckout=document.body.oninit_checkout;document.body.oninit_checkout=()=>{updateFormValues(getData());previousInitCheckout&&previousInitCheckout();};}
function eventuallyInitializeCheckoutBlock(){if(window.wp&&window.wp.data&&typeof window.wp.data.subscribe==='function'){const unsubscribe=window.wp.data.subscribe(function(){unsubscribe();updateCheckoutBlockData(getData());},CHECKOUT_STORE_KEY);}};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",eventuallyInitializeCheckoutBlock);}else{eventuallyInitializeCheckoutBlock();}}(window.wc_order_attribution));